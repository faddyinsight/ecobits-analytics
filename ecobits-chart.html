<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Your EcoBits Scores</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 30px;
        padding: 0;
        text-align: center;
        background-color: #fafafa;
      }
      canvas {
        max-width: 100%;
        margin-bottom: 20px;
      }
      .button-row {
        margin-top: 10px;
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
      }
      button {
        padding: 8px 16px;
        font-size: 14px;
        border: none;
        border-radius: 6px;
        background-color: #4CAF50;
        color: white;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }
      button:hover {
        background-color: #388e3c;
      }
    </style>
  </head>
  <body>
    <h2>Your EcoBits Scores</h2>
    <canvas id="myChart" width="600" height="400"></canvas>

    <div class="button-row">
      <button id="btnDownload">Download Chart as Image</button>
      <button id="btnPrint">Print Chart</button>
      <button id="btnShare">Copy Shareable Link</button>
    </div>

    <script>
      // Get chart data from URL parameters
      function getParam(name) {
        const url = new URL(window.location.href);
        return JSON.parse(url.searchParams.get(name) || "[]");
      }

      const latest = getParam("latest");
      const previous = getParam("previous");
      const average = getParam("average");

      const labels = ['Habits', 'Behavior', 'Trade-offs', 'Planning', 'Belief', 'Peer Effect'];

      const ctx = document.getElementById('myChart').getContext('2d');
      const chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Latest Score',
              data: latest,
              backgroundColor: 'rgba(54, 162, 235, 0.7)'  // Blue
            },
            {
              label: 'Previous Score',
              data: previous,
              backgroundColor: 'rgba(255, 99, 132, 0.7)'  // Red
            },
            {
              label: 'Average Score',
              data: average,
              backgroundColor: 'rgba(255, 206, 86, 0.7)'  // Yellow
            }
          ]
        },
        options: {
          responsive: true,
          animation: false, // Disable load animation
          plugins: {
            title: {
              display: true,
              text: 'Your EcoBits Scores',
              font: { size: 18 }
            },
            legend: {
              position: 'top'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 25
            }
          }
        }
      });

      // Download as image
      document.getElementById("btnDownload").addEventListener("click", function () {
        const link = document.createElement("a");
        link.download = "ecobits_scores.png";
        link.href = document.getElementById("myChart").toDataURL("image/png");
        link.click();
      });

      // Print chart
      document.getElementById("btnPrint").addEventListener("click", function () {
        const printWindow = window.open('', '_blank');
        const imgData = document.getElementById("myChart").toDataURL("image/png");
        printWindow.document.write(`<img src="${imgData}" style="width:100%;">`);
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
      });

      // Copy shareable link
      document.getElementById("btnShare").addEventListener("click", function () {
        const url = new URL(window.location.href);
        navigator.clipboard.writeText(url.href).then(() => {
          alert("âœ… Link copied to clipboard!");
        });
      });
    </script>
  </body>
</html>
